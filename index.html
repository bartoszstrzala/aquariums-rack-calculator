<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PROJEKT REGA≈ÅU - DOKUMENTACJA WARSZTATOWA</title>
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #27ae60; --bg-color: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; margin: 0; background: var(--bg-color); }

        /* SIDEBAR INTERFEJSU */
        .sidebar {
            background: white; padding: 25px; width: 400px; min-width: 400px;
            box-shadow: 2px 0 15px rgba(0,0,0,0.1); height: 100vh; overflow-y: auto; box-sizing: border-box;
        }
        .main-view { flex-grow: 1; overflow-y: auto; padding: 20px; }

        /* STRONY WYDRUKU */
        .print-page {
            background: white; width: 210mm; margin: 0 auto 30px auto; padding: 15mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1); box-sizing: border-box; page-break-after: always;
        }
        /* Pierwsza strona to teraz Landscape dla rega≈Çu */
        .page-main-view { width: 297mm; }

        .header { border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 15px; text-align: center; }
        .section-title { background: #eee; padding: 6px 12px; font-weight: bold; border-left: 5px solid var(--accent-color); margin: 15px 0; }

        .input-group { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        input { width: 80px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 15px; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-update { background: var(--accent-color); }
        .btn-print { background: #34495e; }

        canvas { display: block; margin: 0 auto; background: white; max-width: 100%; }
        .important { color: #d35400; font-weight: 800; }

        /* TABELA LISTY CIƒòCIA */
        .cut-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .cut-table th, .cut-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .cut-table th { background: #f8f9fa; }

        @media print {
            body { background: white; display: block; overflow: visible; }
            .sidebar { display: none !important; }
            .main-view { padding: 0; overflow: visible; width: 100%; }
            .print-page { box-shadow: none; margin: 0; border: none; width: 100% !important; padding: 10mm; height: auto; }

            /* Strona 1: Pozioma */
            @page { size: portrait; margin: 10mm; }
            .page-main-view { page-break-after: always; }
            /* Specyficzne wymuszenie landscape dla strony z rega≈Çem w Chrome/Edge */
            @page { size: auto; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h3 style="margin-top:0">‚öôÔ∏è PARAMETRY</h3>
    <div class="input-group"><label>D≈Ç. akwarium (mm)</label> <input type="number" id="tankL" value="400"></div>
    <div class="input-group"><label>Akwaria w rzƒôdzie</label> <input type="number" id="tanksPerRow" value="11"></div>
    <div class="input-group"><label>Ilo≈õƒá poziom√≥w</label> <input type="number" id="rowCount" value="2"></div>
    <div class="input-group"><label>Szer. akwarium (mm)</label> <input type="number" id="tankW" value="400"></div>
    <div class="input-group"><label>Wys. akwarium (mm)</label> <input type="number" id="tankH" value="400"></div>
    <div class="input-group"><label>Prze≈õwit serwis (mm)</label> <input type="number" id="gap" value="200"></div>
    <div class="input-group"><label>Kant√≥wka (mm)</label> <input type="number" id="beamSize" value="45"></div>
    <div class="input-group"><label>Luz (mm)</label> <input type="number" id="tolerance" value="30"></div>
    <div class="input-group"><label>Max rozpiƒôto≈õƒá (mm)</label> <input type="number" id="maxSpan" value="1000"></div>

    <button class="btn-update" onclick="uiController.update()">AKTUALIZUJ PROJEKT</button>
    <button class="btn-print" onclick="window.print()">üñ®Ô∏è DRUKUJ DOKUMENTACJƒò</button>
</div>

<div class="main-view">
    <div class="print-page page-main-view">
        <div class="header">
            <h1 style="margin:0">ARKUSZ 1: WIDOK FRONTOWY I LISTA ELEMENT√ìW</h1>
            <p id="totalDimsTitle" style="font-size: 18px; font-weight: bold; color: #d35400; margin: 5px 0;"></p>
        </div>

        <canvas id="rackCanvas"></canvas>

        <div class="section">
            <div class="section-title">üì¶ ZESTAWIENIE MATERIA≈Å√ìW (LISTA CIƒòCIA)</div>
            <table class="cut-table">
                <thead>
                <tr><th>Element</th><th>Ilo≈õƒá</th><th>D≈Çugo≈õƒá [mm]</th><th>Opis konstrukcyjny</th></tr>
                </thead>
                <tbody id="cuttingTableBody"></tbody>
            </table>
        </div>
    </div>

    <div class="print-page">
        <div class="header">
            <h1 style="margin:0">ARKUSZ 2: SCHEMATY I MONTA≈ª</h1>
        </div>

        <div class="section">
            <div class="section-title">RZUT Z BOKU (PRZEKR√ìJ)</div>
            <canvas id="sideViewCanvas"></canvas>
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px; font-size: 14px;">
                <span><b style="color:#4a302a">‚ñ†</b> Nogi</span>
                <span><b style="color:#d35400">‚ñ†</b> Poprzeczki</span>
                <span><b style="color:#8d6e63">‚ñ†</b> Belki no≈õne</span>
            </div>
        </div>

        <div class="section">
            <div class="section-title">RZUT Z G√ìRY</div>
            <canvas id="topViewCanvas"></canvas>
        </div>

        <div class="section">
            <div class="section-title">UWAGI TECHNICZNE</div>
            <ul style="font-size: 14px; line-height: 1.6;">
                <li>Zalecane ≈ÇƒÖczenie: wkrƒôty ciesielskie min. 6x100mm.</li>
                <li>Belki pod≈Çu≈ºne (jasny brƒÖz) powinny byƒá mocowane na zewnƒÖtrz n√≥g.</li>
                <li>Poprzeczki (pomara≈Ñczowe) montowane miƒôdzy nogƒÖ przedniƒÖ a tylnƒÖ.</li>
            </ul>
        </div>
    </div>
</div>

<script>
    const uiController = {
        update() {
            const p = {
                tankL: +document.getElementById('tankL').value, tankW: +document.getElementById('tankW').value,
                tankH: +document.getElementById('tankH').value, rowCount: +document.getElementById('rowCount').value,
                tanksPerRow: +document.getElementById('tanksPerRow').value, beamSize: +document.getElementById('beamSize').value,
                tolerance: +document.getElementById('tolerance').value, maxSpan: +document.getElementById('maxSpan').value,
                gap: +document.getElementById('gap').value
            };

            const tankSpace = p.tankL + (p.tolerance / p.tanksPerRow);
            const maxInBay = Math.floor(p.maxSpan / tankSpace) || 1;
            let dist = [], rem = p.tanksPerRow;
            while (rem > 0) { let take = Math.min(rem, maxInBay); dist.push(take); rem -= take; }

            const bayWidths = dist.map(count => (count * p.tankL) + (count * (p.tolerance / p.tanksPerRow)));
            const totalW = bayWidths.reduce((a, b) => a + b, 0) + ((dist.length + 1) * p.beamSize);
            const totalH = 150 + (p.rowCount * (p.tankH + p.gap + p.beamSize)) + p.beamSize;

            const calc = { p, dist, bayWidths, totalW, totalH, bayCount: dist.length, levels: p.rowCount + 1 };

            this.render(calc);
        },

        render(calc) {
            document.getElementById('totalDimsTitle').innerText = `WYMIAR CA≈ÅKOWITY: ${Math.round(calc.totalW)} x ${Math.round(calc.totalH)} x ${calc.p.tankW + calc.p.tolerance} mm`;

            const legQty = (calc.bayCount + 1) * 2;
            const longQty = calc.levels * 2;
            const shortQty = (calc.bayCount + 1) * calc.levels;

            document.getElementById('cuttingTableBody').innerHTML = `
            <tr><td>Nogi (Pion)</td><td>${legQty} szt.</td><td><b class="important">${Math.round(calc.totalH)}</b></td><td>G≈Ç√≥wne s≈Çupy pionowe prz√≥d/ty≈Ç</td></tr>
            <tr><td>Belki pod≈Çu≈ºne</td><td>${longQty} szt.</td><td><b class="important">${Math.round(calc.totalW)}</b></td><td>Poziome podparcie akwari√≥w (front/ty≈Ç)</td></tr>
            <tr><td>Poprzeczki</td><td>${shortQty} szt.</td><td><b class="important">${calc.p.tankW + calc.p.tolerance}</b></td><td>≈ÅƒÖczniki g≈Çƒôboko≈õci (miƒôdzy nogami)</td></tr>
        `;

            this.drawFront(calc);
            this.drawSide(calc);
            this.drawTop(calc);
        },

        drawArrow(ctx, x1, y1, x2, y2, label, color) {
            const head = 10; const angle = Math.atan2(y2 - y1, x2 - x1);
            ctx.save(); ctx.strokeStyle = color; ctx.fillStyle = color; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
            const dh = (tx, ty, a) => {
                ctx.beginPath(); ctx.moveTo(tx, ty);
                ctx.lineTo(tx - head * Math.cos(a - 0.5), ty - head * Math.sin(a - 0.5));
                ctx.lineTo(tx - head * Math.cos(a + 0.5), ty - head * Math.sin(a + 0.5));
                ctx.fill();
            };
            dh(x2, y2, angle); dh(x1, y1, angle + Math.PI);
            ctx.fillStyle = (color === "white") ? "white" : "black";
            ctx.font = "bold 11px Arial"; ctx.textAlign = "center";
            const mx = (x1 + x2) / 2; const my = (y1 + y2) / 2;
            ctx.save(); ctx.translate(mx, my); if(Math.abs(x1-x2)<2) ctx.rotate(-Math.PI/2);
            ctx.fillText(label, 0, (color === "white") ? 4 : -8); ctx.restore(); ctx.restore();
        },

        drawFront(calc) {
            const cvs = document.getElementById('rackCanvas');
            const ctx = cvs.getContext('2d');
            const s = 0.5;
            cvs.width = calc.totalW * s + 200;
            cvs.height = calc.totalH * s + 200;
            ctx.clearRect(0,0, cvs.width, cvs.height);
            const ox = 100, oy = 50;

            ctx.fillStyle = "#8d6e63"; // Beams
            const rowStep = (calc.p.tankH + calc.p.gap + calc.p.beamSize);
            for (let i = 0; i < calc.levels; i++) {
                const y = oy + (calc.totalH - 150 - calc.p.beamSize - (i * rowStep)) * s;
                ctx.fillRect(ox, y, calc.totalW * s, calc.p.beamSize * s);
            }

            for (let i = 0; i < calc.p.rowCount; i++) {
                const yBase = oy + (calc.totalH - 150 - calc.p.beamSize - (i * rowStep)) * s;
                let cx = ox + (calc.p.beamSize * s);
                for (let b = 0; b < calc.bayCount; b++) {
                    const bw = calc.bayWidths[b] * s;
                    const count = calc.dist[b];
                    const startA = cx + (bw - (count * calc.p.tankL * s)) / 2;
                    for (let j = 0; j < count; j++) {
                        ctx.fillStyle = "rgba(173, 216, 230, 0.7)";
                        ctx.fillRect(startA + (j * calc.p.tankL * s) + 2, yBase - calc.p.tankH * s, calc.p.tankL * s - 4, calc.p.tankH * s);
                        ctx.strokeRect(startA + (j * calc.p.tankL * s) + 2, yBase - calc.p.tankH * s, calc.p.tankL * s - 4, calc.p.tankH * s);
                    }
                    this.drawArrow(ctx, cx, yBase + 10, cx + bw, yBase + 10, `${Math.round(calc.bayWidths[b])}`, "white");
                    this.drawArrow(ctx, cx + 15, yBase, cx + 15, yBase - calc.p.tankH * s, `${calc.p.tankH}`, "blue");
                    this.drawArrow(ctx, cx + 15, yBase - calc.p.tankH * s, cx + 15, yBase - rowStep * s + calc.p.beamSize * s, `${calc.p.gap}`, "green");
                    cx += bw + (calc.p.beamSize * s);
                }
            }
            ctx.fillStyle = "#4a302a"; // Legs
            let lx = ox;
            for (let b = 0; b <= calc.bayCount; b++) {
                ctx.fillRect(lx, oy, calc.p.beamSize * s, calc.totalH * s);
                lx += (calc.bayWidths[b] || 0) * s + (calc.p.beamSize * s);
            }
        },

        drawSide(calc) {
            const cvs = document.getElementById('sideViewCanvas');
            const ctx = cvs.getContext('2d');
            const s = 0.8; const depth = calc.p.tankW + calc.p.tolerance;
            cvs.width = 400; cvs.height = 350;
            const ox = 100, oy = 40;

            ctx.fillStyle = "#4a302a"; // Legs
            ctx.fillRect(ox, oy, calc.p.beamSize*s, 280);
            ctx.fillRect(ox + depth*s + calc.p.beamSize*s, oy, calc.p.beamSize*s, 280);

            ctx.fillStyle = "#d35400"; // Poprzeczki
            for(let i=0; i<3; i++) ctx.fillRect(ox + calc.p.beamSize*s, oy + 40 + i*90, depth*s, calc.p.beamSize*s);

            ctx.fillStyle = "#8d6e63"; // Beams end-view
            for(let i=0; i<3; i++) {
                ctx.fillRect(ox - 15, oy + 40 + i*90, 15, calc.p.beamSize*s);
                ctx.fillRect(ox + depth*s + calc.p.beamSize*2*s, oy + 40 + i*90, 15, calc.p.beamSize*s);
            }
            this.drawArrow(ctx, ox + calc.p.beamSize*s, oy + 20, ox + (calc.p.beamSize + depth)*s, oy + 20, `${depth}mm`, "black");
        },

        drawTop(calc) {
            const cvs = document.getElementById('topViewCanvas');
            const ctx = cvs.getContext('2d');
            const s = 0.6; const depth = calc.p.tankW + calc.p.tolerance;
            cvs.width = 400; cvs.height = 200;
            const ox = 50, oy = 40;

            ctx.fillStyle = "#8d6e63";
            ctx.fillRect(ox, oy, 250, calc.p.beamSize*s);
            ctx.fillRect(ox, oy + depth*s, 250, calc.p.beamSize*s);
            ctx.fillStyle = "#d35400";
            ctx.fillRect(ox + 20, oy + calc.p.beamSize*s, calc.p.beamSize*s, (depth - calc.p.beamSize)*s);
            ctx.fillRect(ox + 200, oy + calc.p.beamSize*s, calc.p.beamSize*s, (depth - calc.p.beamSize)*s);
        }
    };

    window.onload = () => uiController.update();
</script>
</body>
</html>